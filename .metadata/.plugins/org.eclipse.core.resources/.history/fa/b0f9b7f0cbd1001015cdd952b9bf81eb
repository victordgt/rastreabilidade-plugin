package rastreabilidade.plugin.artefato;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.eclipse.core.resources.IProject;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.core.runtime.CoreException;
import org.eclipse.jdt.core.IAnnotation;
import org.eclipse.jdt.core.ICompilationUnit;
import org.eclipse.jdt.core.IJavaProject;
import org.eclipse.jdt.core.IMemberValuePair;
import org.eclipse.jdt.core.IType;
import org.eclipse.jdt.core.JavaCore;
import org.eclipse.jdt.core.JavaModelException;

import rastreabilidade.CasoDeUso;
import rastreabilidade.plugin.anotacao.AnotacaoUtil;
import rastreabilidade.plugin.util.PluginUtil;

public class GerenciadorCasoDeUso extends GerenciadorArtefato {


	public GerenciadorCasoDeUso() {
		super(CasoDeUso.class);
	}	
	

	@Override
	protected void filtrar(List<IType> classesComAnotacao) {

		AnotacaoUtil anotacaoUtil = new AnotacaoUtil();

		for (IType classe : classesComAnotacao) {

			IAnnotation[] anotacoes;
			try {
				anotacoes = classe.getAnnotations();

				for (IAnnotation annotation : anotacoes) {

					if (AnotacaoUtil.comparaAnotacaoClasse(CasoDeUso.class, annotation)) {
						try {
							IMemberValuePair[] membros = annotation.getMemberValuePairs();
							String nome = (String)anotacaoUtil.recuperaMemberValuePair("nome", membros);
							List<IType> listaTipos = mapaArtefatos.get(nome);

							if (listaTipos == null) {
								listaTipos = new ArrayList<IType>();
								mapaArtefatos.put(nome, listaTipos);
							}		

							listaTipos.add(classe);
						} catch (IllegalArgumentException e) {
							e.printStackTrace();
						} catch (JavaModelException e) {
							e.printStackTrace();
						}
					}
				}				

			} catch (JavaModelException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
		}
	}
}
